# Common settings
use_sim_time: true

# ─────────────────────────────────────────────────────────────────────────────
lifecycle_manager_navigation:
  ros__parameters:
    use_sim_time: true
    autostart: true
    node_names:
      - map_server
      - global_costmap
      - local_costmap
      - planner_server
      - controller_server
      - smoother_server
      - bt_navigator

# ─────────────────────────────────────────────────────────────────────────────
bt_navigator:
  ros__parameters:
    plugin_lib_names: ["nav2_bt_navigator/BehaviorTreeEngine"]
    bt_xml_filename: "behavior_trees/navigate_w_replanning_and_recovery.xml"
    planner_server: "planner_server"
    controller_server: "controller_server"

# ─────────────────────────────────────────────────────────────────────────────
map_server:
  ros__parameters:
    yaml_filename: "<path_to_your_map>.yaml"
    use_sim_time: true
    topic_name: "map"
    frame_id: "map"
    allow_no_topic: false

# ─────────────────────────────────────────────────────────────────────────────
global_costmap:
  ros__parameters:
    global_frame: "map"
    robot_base_frame: "base_link"
    update_frequency: 5.0
    publish_frequency: 5.0
    width: 10.0
    height: 10.0
    resolution: 0.05
    static_layer:
      plugin: "nav2_costmap_2d::StaticLayer"
      map_subscribe_transient_local: true
    obstacle_layer:
      plugin: "nav2_costmap_2d::ObstacleLayer"
      observation_sources: "scan"
      scan:
        topic: "scan"
        expected_update_rate: 0.0
        observation_persistence: 0.0
        transformation_tolerance: 0.0
    inflation_layer:
      plugin: "nav2_costmap_2d::InflationLayer"
      inflation_radius: 0.6
    plugins: ["static_layer", "obstacle_layer", "inflation_layer"]

# ─────────────────────────────────────────────────────────────────────────────
local_costmap:
  ros__parameters:
    global_frame: "odom"
    robot_base_frame: "base_link"
    update_frequency: 5.0
    publish_frequency: 2.0
    rolling_window: true
    width: 6.0
    height: 6.0
    resolution: 0.05
    obstacle_layer:
      plugin: "nav2_costmap_2d::ObstacleLayer"
      observation_sources: "scan"
      scan:
        topic: "scan"
        expected_update_rate: 0.0
        observation_persistence: 0.0
        transformation_tolerance: 0.0
    inflation_layer:
      plugin: "nav2_costmap_2d::InflationLayer"
      inflation_radius: 0.4
    plugins: ["obstacle_layer", "inflation_layer"]

# ─────────────────────────────────────────────────────────────────────────────
planner_server:
  ros__parameters:
    expected_planner_frequency: 5.0
    planner_plugins: ["GridBased"]
    GridBased:
      plugin: "nav2_navfn_planner/NavfnPlanner"
      tolerance: 0.5
      use_astar: false
      allow_unknown: true

# ─────────────────────────────────────────────────────────────────────────────
smoother_server:
  ros__parameters:
    smoother_plugins: ["SimpleSmoother"]
    SimpleSmoother:
      plugin: "nav2_smoother/SimpleSmoother"
      tolerance: 0.001
      max_iterations: 100
      do_refinement: true

# ─────────────────────────────────────────────────────────────────────────────
controller_server:
  ros__parameters:
    controller_frequency: 10.0
    controller_plugins: ["FollowPath"]
    FollowPath:
      plugin: "nav2_regulated_pure_pursuit_controller/RegulatedPurePursuitController"
      desired_linear_vel: 0.5
      min_lookahead_dist: 0.3
      lookahead_dist: 0.6
      use_velocity_scaled_lookahead_dist: true
      max_lookahead_dist: 1.5
      lookahead_time: 1.5
      use_rotate_to_heading: true
      rotate_to_heading_min_angle: 0.785
      rotate_to_heading_angular_vel: 1.0